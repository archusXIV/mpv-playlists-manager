#!/bin/bash
# ~/.config/mpm/mpmrc (version 1.3-7)

########################################################
#                                                      #
#    ███╗   ███╗██████╗ ███╗   ███╗██████╗  ██████╗    #
#    ████╗ ████║██╔══██╗████╗ ████║██╔══██╗██╔════╝    #
#    ██╔████╔██║██████╔╝██╔████╔██║██████╔╝██║         #
#    ██║╚██╔╝██║██╔═══╝ ██║╚██╔╝██║██╔══██╗██║         #
#    ██║ ╚═╝ ██║██║     ██║ ╚═╝ ██║██║  ██║╚██████╗    #
#    ╚═╝     ╚═╝╚═╝     ╚═╝     ╚═╝╚═╝  ╚═╝ ╚═════╝    #
#                                                      #
####### MPV-PLAYLISTS-MANAGER CONFIGURATION FILE #######
######### THE PLACE FOR YOUR PERSONAL SETTINGS #########
#~~~~~ change the values, not the variables names ~~~~~#

# shellcheck disable=SC2034,SC2016,SC2154
: "${XDG_DATA_HOME:-$HOME/.local/share}"

# change the main mpm window size. (the actual size is 1260x738)
function _ResizeWindow { wmctrl -r :ACTIVE: -e 5,-1,-1,1260,738; } 2>/dev/null

### PROMPTS & MESSAGES COLORS
### https://misc.flogisoft.com/bash/tip_colors_and_formatting
### Console_colors (default) will always use your current ~/.Xresources colors,
### or custom rgb/hex colors so you can set your own theme.
### nc=normal text, critical=warnings, info=normal prompt, mtitle=menus title,
### task=infos like: direct download, audio conversion type etc...
function _Theme {
    case "$1" in
        default)
            nc=$'\e[0m';
            critical=$'\e[31m';
            info=$'\e[32m';
            mtitle=$'\e[33m';
            task=$'\e[37m';
        ;;
        gruvbox)
            # Using RGB colors for array 'customColors'
            nc=$'\e[38;2;69;133;136m';      # #458588 "0x45 0x85 0x88"
            critical=$'\e[38;2;204;36;29m'; # #CC241D "0xcc 0x24 0x1d"
            info=$'\e[38;2;104;157;106m';   # #689d6a "0x68 0x9d 0x6a"
            mtitle=$'\e[38;2;215;153;33m';  # #D79921 "0xd7 0x99 0x21"
            task=$'\e[38;2;235;219;178m';   # #ebdbb2 "0xeb 0xdb 0xb2"
            # enter the last three numbers of your custom sequence.
                        #   normal text  critical      info          mtitle       task
            customColors=( "69;133;136" "204;36;29" "104;157;106" "215;153;33" "235;219;178" )
        ;;
        chocolat-pistache)
            # Using HEX colors for array 'customColors'
            nc=$'\e[38;2;140;117;94m';      # #8C755E "0x8c 0x75 0x5e"
            critical=$'\e[38;2;215;95;65m'; # #D75F41 "0xd7 0x5f 0x41"
            info=$'\e[38;2;146;196;113m';   # #92C471 "0x92 0xc4 0x71"
            mtitle=$'\e[38;2;242;203;87m';  # #F2CB57 "0xf2 0xcb 0x57"
            task=$'\e[38;2;249;230;176m';   # #F9E6B0 "0xf9 0xe6 0xb0"
            customColors=( "0x8c 0x75 0x5e" "0xd7 0x5f 0x41" "0x92 0xc4 0x71" \
            "0xf2 0xcb 0x57" "0xf9 0xe6 0xb0" )
        ;;
    esac
}

# apply the theme by calling function _Theme "name" ...
_Theme default

## default editor
MPMEDITOR="vim"

## default file manager (can be any terminal file manager)
## used in option 5) Load local dir/files
FILEMANAGER="ranger"

## THESE ARE BY DEFAULT DIRECTORIES USED BY MPM.

# The main directory can be renamed but must be present for mpm to work.
# main_dir="$HOME/Documents/mpv-playlists-manager"
main_dir="$XDG_DATA_HOME/mpv-playlists-manager"

# The default playlist & all the created ones are stored here.
playlists_dir="$main_dir/playlists"

# Be carefull with this one because if you choose to use the conversion action,
# ALL .webm files in that directory will be converted.
audios_dir="$HOME/Documents/Music/mpm_audios"
videos_dir="$HOME/Documents/Videos/mpm_videos"
titles_dir="$main_dir/titles"
tmp_dir="$main_dir/tmp"

# some links may still be present in playlist files...
# if value is 'no' you will be prompted.
keep_none_empty_playlist="yes"

## DEFAULT TASKS ANSWERS
# from download tasks (option 4) we are prompted or not to choose formats.
# (will appear in main menu)
direct_download="no"

# audio files (.webm) conversion.
# (will appear in main menu)
automatic_audio_conversion="no"

# default audio conversion format {mp3,flac,wav,ogg},
# mp3 & ogg in 320k, flac & wav are lossless.
# if value is empty you will be prompted.
# (will appear in main menu)
default_conversion_format="mp3"

# this takes place only after downloading/playing from a collection playlist.
# (will appear in main menu)
quit_after_task="no"

## FFMPEG SPECIFICS (audio conversion)
# !!! You can change ffmpeg audio codec command line settings !!!
function _mp3 {
    find . -iname "*.webm" -exec \
    bash -c 'FILE="$1"; \
        ffmpeg -i "${FILE}" \
        -acodec libmp3lame -ar 48000 -ab 320k \
        -y "${FILE%.webm}.mp3";' _ '{}' \; 2>"$FFOP"
    find . -iname "*.webm" -exec rm {} \;
}

function _flac {
    find . -iname "*.webm" -exec \
    bash -c 'FILE="$1"; \
        ffmpeg -i "${FILE}" \
        -af aformat=s32:48000 \
        -y "${FILE%.webm}.flac";' _ '{}' \; 2>"$FFOP"
    find . -iname "*.webm" -exec rm {} \;
}

function _wav {
    find . -iname "*.webm" -exec \
    bash -c 'FILE="$1"; \
        ffmpeg -i "${FILE}" \
        -acodec pcm_s32le -ar 48000 \
        -y "${FILE%.webm}.wav";' _ '{}' \; 2>"$FFOP"
    find . -iname "*.webm" -exec rm {} \;
}

function _ogg {
    find . -iname "*.webm" -exec \
    bash -c 'FILE="$1"; \
        ffmpeg -i "${FILE}" \
        -acodec libvorbis -ar 48000 -ab 320k \
        -y "${FILE%.webm}.ogg";' _ '{}' \; 2>"$FFOP"
    find . -iname "*.webm" -exec rm {} \;
}

## MPV SPECIFICS
# mpv audio online playing command line
function _MpvAudioOptions {
    # change mpv audio settings here if needed but do not remove $M3UFILE
    mpv \
    --input-ipc-server='/tmp/mpvsocket' \
    --no-config \
    --term-playing-msg="${info}"'Title: ${media-title}'"${nc}" \
    --ytdl-format='bestaudio/best' "$M3UFILE"
}

# mpm video online playing command line
function _MpvVideoOptions {
    # same as above.
    mpv \
    --input-ipc-server='/tmp/mpvsocket' \
    --cache \
    --no-config \
    --term-playing-msg="${info}"'Title: ${media-title}'"${nc}" \
    --ytdl-format='299+251/298+251/137+251/136+251/best' "$M3UFILE"
}

# change the yt-dlp downloader presets ONLY for youtube video downloads
# (not tested elsewhere)
# take a look at 'man yt-dlp'
# !!! do not change the name of the array (ytdlPreset_<*>) !!!
# downloader name
ytdlPreset_DN=( --downloader m3u8:ffmpeg )
# downloader arguments
ytdlPreset_DA=( --downloader-args '-n' )
# merge format
ytdlPreset_MF=( --merge-output-format mp4 )
# downloader warnings
ytdlPreset_DW=( --no-warnings )
# downloader progress
ytdlPreset_DP=( --progress )
# downloader filename sanitization
# (this avoid the creation of subdirectories because of filenames containing '/').
ytdlPreset_FS=( --compat-options filename-sanitization )
# downloader without multiple format codes
ytdlPreset_NC=( "${ytdlPreset_DW[@]}" "${ytdlPreset_DP[@]}" )
# combined presets
ytdlPreset_X=( "${ytdlPreset_DN[@]}" "${ytdlPreset_DA[@]}" \
"${ytdlPreset_MF[@]}" "${ytdlPreset_DW[@]}" "${ytdlPreset_DP[@]}" )