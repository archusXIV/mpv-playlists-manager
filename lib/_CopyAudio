#!/bin/bash
## This is a part of main script: mpm.

_CopyAudio() {

    while (( $(grep "" -c "$QUEUE") > 0 )); do
        rm "$tmp_dir"/1 2>/dev/null
        if [[ -f $VIDEO_INFO ]]; then
            echo -e " ${r}Video links have been added earlier...${nc}\n"
        fi
        __
        echo -e " Paste an url to fill the ${g}audio${nc} playlist:\n"
        read -r url

        [[ $url =~ 'playlist?list=' ]] && {
            echo -e " ${g}Checking youtube playlist availability...please wait.${nc}\n"
            _GetYoutubePlaylistUrls -a
            _RemoveCrap 2>/dev/null
        }

        echo -e " ${g}Verifying media codes from selected file...${nc}\n"
        youtube-dl -F --no-warnings "$url" >"$YTOP"
        if [[ $? -eq 1 ]]; then
            echo "$url" >> "$tmp_dir"/badurl
            echo -e " ${r}${b}No format code found!${nb}\n $line will be removed."
            echo -e " ${g}Please visit: https://github.com/ytdl-org/youtube-dl/blob/master/docs/supportedsites.md${nc}\n"
            sleep 5
        else
            echo "$url" | tee -a "$QUEUE" >> "$AUDIO_INFO"
            sleep 1
            echo -e " ${g}Getting titles...${nc}\n"
            youtube-dl --get-title --no-warnings \
            "$(sed -r -n '$ p' "$AUDIO_INFO")" >> "$AUDIO_TITLE"
            _RemoveCrap 2>/dev/null
        fi

        _ResizeWindow
        clear
        _ListsCount

        __
        echo -e "                                                    ${r}::audio options::${nc}"
        echo -e "                              ┌─────────────────────────────────────────────────────────────┐"
        echo -e "                              │     1) Add more audio links       4) Play current list      │"
        echo -e "                              │     2) Download current list      5) View current list      │"
        echo -e "                              │     3) Save playlist as           6) Back to main menu      │"
        echo -e "                              └─────────────────────────────────────────────────────────────┘"
        echo -e "                                                    ${g}${b}Select an item${nb}${nc}"
        __
        read -rsn 1 options
        case "$options" in
            1)  continue
                __ ;;
            2)  _GetAudio
                break ;;
            3)  _Save -a
                __ ;;
            4)  _LoadAudio -a
                __ ;;
            5)  _ViewUrlInfo -a
                __ ;;
            6)  _Menu
                __ ;;
        esac
    done
}
