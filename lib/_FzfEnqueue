#!/bin/bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154,SC2034,SC2128
_FzfEnqueue() {

    cd "$MEDIA_DIR"/"$dir" || return
    _ResizeWindow
    rm ./fzfEnqueue.m3u 2>/dev/null

    ! command -v "$fzf_preview" && fzf_preview=(file -N -i --)
    
    command ls "$MEDIA_DIR"/"$dir" | sed '/fzfEnqueue.m3u/d' \
    | fzf \
    --multi \
    --reverse \
    --scroll-off=5 \
    --border rounded \
    --prompt='Search: ' \
    --header "${info}${b}"'Press Tab to select, Enter to confirm: '"${nb}${nc}" \
    --preview-window="$fzf_preview_layout:$fzf_preview_size" \
    --preview="$fzf_preview {}" >> fzfEnqueue.m3u

    [[ ! -s ./fzfEnqueue.m3u ]] && {
        rm ./fzfEnqueue.m3u
        return
    }

    use_mpvc_locally="yes"
    mpv --no-terminal "${mpvGenOptions_SK[@]}" \
    "${mpvGenOptions_ID[@]}" fzfEnqueue.m3u &
    ln -sr ./fzfEnqueue.m3u "$NOWPLAYING"

}