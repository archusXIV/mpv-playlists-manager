#!/bin/bash
## This is a part of main script: mpm.

_DownloadCompleted() {
    cd "$playlists_dir"
    
    if [[ -n $(find "$main_dir" -name "*.part") ]]; then
        mv {"$AUDIO_INFO"_origin,"$VIDEO_INFO"_origin} "$playlists_dir" 2>/dev/null
        echo " ${r}Temporary playlists have been moved in $playlists_dir."
        echo -e " Incomplete files in audio/video dir:\n${nc}"
        find . -name "*.part" | sort -d | sed 's,.*/,,' | cat -n
        __
        echo " ${g}Keep them in if you want to resume downloads,"
        echo " by using '.m3u_origin' files in section: 4) Load a playlist,"
        echo " in this session or later.${nc}"
        sleep 15
        _Menu
    else
        if [[ -f $list ]] && [[ $(_GetLinesList -l) -ge 2 ]]; then
            _Prompt \
            " ${g}Downloads completed, do you want to KEEP $list?: ${nc}" || {
                rm "$list" "$list"_origin "$tmp_dir"/{*.m3u_origin} 2>/dev/null
            }
            if [[ -f $QUEUE_origin ]]; then
                rm "$QUEUE"_origin
            else
                rm "$list"_origin
                rm \
                {"$CHOOSE1","$CHOOSE1"_origin,"$CHOOSE2","$CHOOSE2"_origin} 2>/dev/null
            fi
        else
            echo " ${g}Downloads completed, ${r}$list is empty... $list removed.${nc}"
            sleep 5s
            rm \
            "$list" "$list"_origin "$titles_dir"/"$list".titles 2>/dev/null
            rm \
            {"$CHOOSE1","$CHOOSE1"_origin,"$CHOOSE2","$CHOOSE2"_origin} 2>/dev/null
        fi
        _Menu
    fi
}
