#!/bin/bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154,SC2034
_SearchOnline() {

    local pkg platform

    __searchOnlineTips() (
        clear
        __
        printf '%s\n' \
        " ${critical}Tip: In the ${pkg} menu press ${task}Tab ${critical}on the desired ${Type} titles," \
            " then press ${task}Enter ${critical}to confirm. Press ${task}Escape ${critical}to cancel." \
            " (note that multi selection is supported)${nc}"
    )

    __searchOnlinePlatform() {
        __
        read -rsn1 \
        -p " ${info}Search ${Type} on [Y]outube, [O]dysee, [P]eertube: ${nc}" \
        platformOptions
        
        case "$platformOptions" in
            o|O)
                platform=Odysee
                __searchOnlineTips
                _SearchOnlineWithYtfzf -o
            ;;
            p|P)
                platform=Peertube
                __searchOnlineTips
                _SearchOnlineWithYtfzf -p
            ;;
            y|Y)
                platform=YouTube
                __searchOnlineTips
                _SearchOnlineWithYtfzf -y
            ;;
            *)
                _WrongOption "$platformOptions"
                clear
            ;;
        esac

    }

    if [[ -n $(command -v fzf) && -n $(command -v ytfzf) ]]; then
        __
        read -rsn1 \
        -p " ${info}Search ${Type} with regular [F]zf or [Y]tfzf script?: ${nc}" \
        searchOnlineOptions
        
        case "$searchOnlineOptions" in
            f|F)
                pkg="fzf"
                __searchOnlineTips
                _SearchYoutubeWithFzf
            ;;
            y|Y)
                pkg="ytfzf"
                __searchOnlinePlatform
                __searchOnlineTips
            ;;
            *)
                _WrongOption "$searchOnlineOptions"
                clear
            ;;
        esac

    elif command -v fzf >/dev/null; then
        pkg="fzf"
        __searchOnlineTips
        _SearchYoutubeWithFzf
    elif command -v ytfzf >/dev/null; then
        pkg="ytfzf"
        __searchOnlinePlatform
        __searchOnlineTips
    else
        printf '%s\n' " ${critical}neither fzf nor ytfzf are installed...${nc}"
        sleep 3
        return
    fi

}
