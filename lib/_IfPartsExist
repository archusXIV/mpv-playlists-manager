#!/usr/bin/env bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154
_IfPartsExist() {

    local file
    __ifPartsExistInfo() {
        clear
        echo -e "\n ${critical}Incomplete files in $mediaDir directory:${nc}\n"
        find "$mediaDir" -name "*.part" -printf '%f\n' | sort -d | nl
        echo -e "\n ${critical}${file##*/} failed, try again now or later.${nc}"
        unset file
        read -rsn 1 -p " ${info}Press any key to continue...${nc}"
        return
    }

    mapfile -t parts < <(find "$mediaDir" -name "*.part")

    case "$1" in
        --list)
            if ((${#parts[@]} >= 1)); then
                mv -f "$playlists_dir"/"$list"_origin "$playlists_dir"/"$list"
                mv -f "$titles_dir"/"$list".titles_origin "$titles_dir"/"$list".titles
                file="$playlists_dir/$list"
                __ifPartsExistInfo
            fi
        ;;
        --tmp)
            if ((${#parts[@]} >= 1)); then
                declare -a files=(
                    "$AUDIO_URLS" "$AUDIO_TITLES"
                    "$VIDEO_URLS" "$VIDEO_TITLES"
                    "$DEFAULT_LIST" "$DEFAULT_TITLES"
                    "$playlists_dir/$list"
                    "$titles_dir/$list.titles"
                    "$playlists_dir/loadMultiplePlaylists.m3u"
                    "$titles_dir/loadMultiplePlaylists.m3u.titles"
                )
                for f in "${files[@]}"; do
                    mv -f "$f"_origin "$f" && file="$f"
                done 2>/dev/null
                __ifPartsExistInfo
            fi
        ;;
    esac

}
