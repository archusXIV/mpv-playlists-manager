#!/usr/bin/env bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154,SC2034
_IfPartsExist() {

    mapfile -t parts < <(find "$mediaDir" -maxdepth 1 -name "*.part")

    declare -a pairs=(
        "$AUDIO_URLS:$AUDIO_TITLES"
        "$VIDEO_URLS:$VIDEO_TITLES"
        "$DEFAULT_LIST:$DEFAULT_TITLES"
        "$playlists_dir/$list:$titles_dir/$list.titles"
        "$playlists_dir/loadMultiplePlaylists.m3u:$titles_dir/loadMultiplePlaylists.m3u.titles"
    )

    if ((${#parts[@]} > 0)); then

        for pair in "${pairs[@]}"; do
            IFS=':' read -r urls titles <<< "$pair"
            local origin="${urls}_origin"
            if [[ -f $origin ]]; then
                mv -f "$origin" "$urls"
                mv -f "${titles}_origin" "$titles"
                break
            fi
        done

        clear
        echo -e "\n ${critical}Incomplete file(s) detected:${nc}\n"
        printf '%s\n' "${parts[@]##*/}" | sort -d | nl
        _BlankLine
        printf '%s\n' " ${critical}${#urls[@]} file(s) from ${M3UFILE##*/} failed to download," \
        " ${M3UFILE##*/} has been preserved, try again later.${nc}"
        unset IFS urls
        read -rsn 1 -p " ${info}Press any key to continue...${nc}"

        clear
        _PolybarIpc
        _CheckParallelDownloads --after
        _Menu

    fi

}
