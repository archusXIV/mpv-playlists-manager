#!/bin/bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154,SC2034
_ViewDefaultUrlsInfo() {

    local file Type
    file="${DEFAULT_LIST##*/}" file="${file%%.*}"
    Type=default

    __getAudioVideo() {
        __
        read -rsn 1 \
        -p "${info} Download [A]udio, [V]ideo, [${mtitle}C${info}]ancel: ${nc}" get
        case "$get" in
            a|A) __; _GetAudio -q ;;
            v|V) __; _GetVideo -q ;;
            *) _ViewAudioVideoUrlsInfo -q ;;
        esac
    }

    if (($(_GetLinesList -q) > 0)); then
        rm "$tmp_dir"/1 2>/dev/null

        [[ $(grep "" -c "$DEFAULT_TITLES" 2>/dev/null) -ne $(_GetLinesList -q) ]] && {
            printf '%s\n' " ${critical}Default list as been modified," \
            " ${task}${b}Updating Default list titles...${nb}${nc}"
            _GetMediaTitle -q
        }
        clear

        while [[ -f $DEFAULT_LIST ]]; do
            menuTitleType=DEFAULT
            URLS="$DEFAULT_LIST"
            TITLES="$DEFAULT_TITLES"
            __
            __listHeader
            read -rsn 1 viewDefaultUrlsInfOptions
            case "$viewDefaultUrlsInfOptions" in
                d|D)
                    if [[ $downloadTmpList = default || -f $pidofMpv ]]; then
                        __getAudioVideo
                    else
                        _MpvOwnsTmpList --default || __getAudioVideo
                    fi
                ;;
                m|M) _Menu ;;
                p|P)
                    if [[ -f $pidofMpv ]]; then
                        _StartUp
                    else
                        _MpvOwnsTmpList --default || \
                        __
                        read -rsn 1 \
                        -p "${info}"' Play [A]udio, [V]ideo?: '"${nc}" play
                        case "$play" in
                            a|A) _LoadAudioVideo -qa ;;
                            v|V) _LoadAudioVideo -qv ;;
                            *)
                                _WrongOption "$play"
                                return
                            ;;
                        esac
                    fi
                ;;
                r|R)
                    if [[ -f $pidofMpv ]]; then
                        _Remove -q
                    else
                        _MpvOwnsTmpList --default || _Remove -q
                    fi
                ;;
                s|S)
                    if [[ -f $pidofMpv && -f $DEFAULT_TITLES ]]; then
                        _Save -q
                    elif [[ -f $DEFAULT_TITLES ]]; then
                        _MpvOwnsTmpList --default || _Save -q
                    else
                        printf '%s\n' " ${critical}Default list does not exist," \
                        " ${task}${b}Updating Default list titles...${nb}${nc}"
                        _GetMediaTitle -q
                        nl < "$DEFAULT_TITLES"
                        _Save -q
                    fi
                ;;
                *)
                    _WrongOption "$viewDefaultUrlsInfOptions"
                    return
                ;;
            esac
        done
    else
        echo " ${critical}There is nothing to do, Default playlist is empty...${nc}"
        sleep 3
    fi
}
