#!/bin/bash
## This is a part of main script: mpm.

_RemoveCrap() {
    # After some tests it appears that a single link copied from a youtube playlist
    # causes the download of the entire playlist.
    # So with sed & perl we cleanup the link to get the direct link to the desired video.
    # Note that this behavior does not occur during a simple viewing/listening.

    LISTS=(
        "$URLS"
        "$TITLES"
        "$QUEUE"
        "$DEFAULTITLES"
    )
    
    for file in "${LISTS[@]}"; do
        # removing unwanted parts of links, blank lines & duplicates
        sed -i '
            s/&list=.*//;s/&pp=.*//;/^\s*$/d;
            s|//youtube.com|//www.youtube.com|g
        ' "$file"
        perl -i -ne 'print if ! $a{$_}++' "$file"

        [[ $file = "$TITLES" || $file = "$DEFAULTITLES" ]] \
            && sed -i 's/-\s//;s/\//_/g;/^\s*$/d;' "$file"

    done 2>/dev/null

}
