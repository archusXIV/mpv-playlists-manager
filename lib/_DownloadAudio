#!/bin/bash
## This is a part of main script: mpm.

_DownloadAudio() {
    cd "$playlists_dir"

    clear
    cp -f "$list" "$list"_origin 2>/dev/null

	local counter=$(grep -v -c '#EXTM3U' "$list")

    for downaudiourl in $(grep -v '#EXTM3U' "$list"); do
        clear
        __
        echo " ${g}Codes for $(_GetLinkTitle -l):${nc}"
        youtube-dl -F --no-warnings "$downaudiourl" | sed -n '
        1,5d;6,7p;/audio only/p' | sed '/^sb2/d' 2>/dev/null
        __
        echo " ${g}Choose a format code: ${nc}"
        read -r code
        clear
        cd "$audios_dir"
        printf '%s\n' " ${g}Total downloads: $counter${nc}"
        youtube-dl -f "$code" --no-warnings --progress "$downaudiourl"
        sed -i '2d' "$playlists_dir"/"$list"
        sed -i '1d' "$titles_dir"/"$list".titles
        let "counter--"
        clear

    done

    echo -e " ${g}Done${nc}\n"

    if [[ -n $(find . -iname "*.webm") ]]; then
        echo " ${r}ADVISORY: if you choose conversion, all downloaded files"
        echo -e " will be converted in the chosen format.${nc}\n"
        find . -iname "*.webm" | sed 's,.*/,,'
        __
        _Prompt " ${g}Do you wish to convert them?: ${nc}" || {
            _DownloadCompleted
        }
        _ConvertAudio && _DownloadCompleted
    else
        _DownloadCompleted
    fi

}
