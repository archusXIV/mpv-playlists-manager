#!/bin/bash
## This is a part of main script: mpm.

_DownloadAudio() {

    cd "$audios_dir"
    clear
    cp -f "$list" "$list"_origin 2>/dev/null

    for url in $(grep '^https' "$list"); do
        # We compare if the content of $list is less than 3 because:
        # 1) we have expression #EXTM3U at the top.
        # 2) the uniq url we've enter...if that's the case.
        if (( $(_GetLinesList -l) < 3 )); then
            __
            echo " ${g}There is $(_GetLinesList -l) audio file left to download.${nc}"
        else
            __
            echo " ${g}There are $(_GetLinesList -l) audio files left to download.${nc}"
        fi

        __
        echo -e " ${g}Codes for: $(_GetLinkTitle -d).${nc}\n"
        youtube-dl -F --no-warnings "$url" | sed -n '1,3d;5,7p;/audio only/p' 2>/dev/null
        __
        echo " ${g}Choose a format code: ${nc}"
        read -r code
        clear
        echo -e " ${g}Downloading ${r}$(_GetLinkTitle -d)...${nc}\n"
        youtube-dl -f "$code" --no-warnings --progress "$url"
        sed -i '2d' "$list"; sed -i '1d' "$tmp_dir"/download
        clear

    done

    echo -e " ${g}Done${nc}\n"

    if [[ -n $(find . -iname "*.webm") ]]; then
        echo -e " ${r}Advisory: IF YOU CHOOSE CONVERSION, ALL FILES WILL BE IN THE CHOSEN FORMAT.${nc}\n"
        find . -iname "*.webm" | sed 's,.*/,,'
        __
        echo -e " ${g}Do you wish to convert them? [Y/n]: ${nc}\n"
        read -rsn 1 answer

        case "$answer" in
            Y|y)    _ConvertAudio ;;
            n|N)    _DownloadCompleted ;;
        esac
        _DownloadCompleted
    else
        _DownloadCompleted
    fi

}
