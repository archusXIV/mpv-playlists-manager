#!/bin/bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154
_SearchOnlineWithYtfzf() {
    __
    read -rp " ${info}Search for ${Type} links (Use quotes for multiple search terms): ${nc}" request

    if [[ -n $request ]]; then
        # ytfzfOptions_X are defined in ~/.config/mpm/mpmrc
        ytfzf \
            --show-thumbnails \
            -I VJ "${ytfzfOptions_X[@]}" "$request$*" >> "$tmp_dir"/ytfzf.json
        
        clear
        test ! -s "$tmp_dir"/ytfzf.json && return

        jq --raw-output '.[].url' "$tmp_dir"/ytfzf.json \
        | tee -a "$QUEUE" >> "$URLS"
        jq --raw-output '.[].title' "$tmp_dir"/ytfzf.json \
        | tee -a "$DEFAULTITLES" >> "$TITLES"
        _RemoveCrap

        for file in {"$QUEUE","$URLS"}; do
            while read -r line; do
                [[ $line =~ 'playlist?list=' ]] && \
                    echo "$line" >> "$YTSEARCH"
            done < "${file}"
        done

        perl -i -ne 'print if ! $a{$_}++' "$YTSEARCH" 2>/dev/null
        sed -i '/playlist/d' {"$QUEUE","$URLS"}
        __; printf '%s\n' " ${info}Links added to $Type list${nc}"
        sleep 2
        rm "$tmp_dir"/ytfzf.json

    else
        return
    fi
    
}