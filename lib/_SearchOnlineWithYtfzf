#!/bin/bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154
_SearchOnlineWithYtfzf() {
    __
    printf '%s\n' " ${critical}Tip: To select mutiple links in the ytfzf menu press ${task}Tab" \
    " ${critical}on the desired ${Type} titles, ${task}Ctrl P${critical} to view next page...etc" \
    " then ${task}Enter ${critical}to confirm and go back in $menuTitleType OPTIONS menu.${nc}"
    __
    read -rp " ${info}Search for online ${Type} links: ${nc}" request

    if [[ -n $request ]]; then
        # ytfzf_options are defined in ~/.config/mpm/mpmrc
        ytfzf -tL "${ytfzfOptions_X[@]}" "$request$*" >> "$tmp_dir"/fzf.urls

        clear
        test ! -s "$tmp_dir"/fzf.urls  && return

        while read -r line; do

            if [[ $line =~ 'playlist?list=' ]]; then
                echo "$line" >> "$YTSEARCH"
            else
                echo "$line" >> "$QUEUE"
                __
                printf '%s\n' " ${info}Getting $line title...${nc}"
                _YtdlGetTitle "$line" | tee -a "$tmp_dir"/fzf.titles >> "$DEFAULTITLES"
                sleep 1
                clear
            fi

        done < "$tmp_dir"/fzf.urls

        cat "$tmp_dir"/fzf.urls >> "$URLS"
        cat "$tmp_dir"/fzf.titles >> "$TITLES"
        rm "$tmp_dir"/fzf.{titles,urls}
        _RemoveCrap

    else
        return
    fi
    
}