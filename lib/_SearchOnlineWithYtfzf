#!/bin/bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154
_SearchOnlineWithYtfzf() {
    __
    read -rp " ${info}Search for ${Type} links (Use quotes for multiple search terms): ${nc}" request

    [[ -z $request ]] && return

    # ytfzfOptions_X are defined in ~/.config/mpm/mpmrc
    ytfzf \
        --show-thumbnails \
        -I VJ "${ytfzfOptions_X[@]}" "$request$*" >> "$YTFZFJSON"
        
    clear
    test ! -s "$YTFZFJSON" && {
        rm "$YTFZFJSON"
        return
    }
    
    jq --raw-output '.[].url' "$YTFZFJSON" \
    | tee -a "$QUEUE" >> "$URLS"
    jq --raw-output '.[].title' "$YTFZFJSON" \
    | tee -a "$DEFAULTITLES" >> "$TITLES"
    _RemoveCrap

    for file in {"$QUEUE","$URLS"}; do
        while read -r line; do
            [[ $line =~ 'playlist?list=' ]] && \
                echo "$line" >> "$YTSEARCH"
        done < "${file}"
    done

    perl -i -ne 'print if ! $a{$_}++' "$YTSEARCH" 2>/dev/null
    __; printf '%s\n' " ${info}Links added to $Type list${nc}"
    sleep 2
    rm "$YTFZFJSON"
    
}