#!/usr/bin/env bash
## This is a part of main script: mpm.

# shellcheck disable=SC2034,SC2154
_WhileMpvIsRunning() {
    local mpv_is_running="yes"
    touch "$tmp_dir"/playerSelectedFile

    # Start monitoring mpv in background - this creates one child process
    (
        echo "$BASHPID" >> "$MPM_PIDS"

        while _PidOfMpv >/dev/null; do
            sleep 1
        done

        mpv_is_running="no"
        localPlaylist="no"

        if [[ $mpvc_tui == native ]]; then
            cmd=fzf
        else
            cmd="$mpvc_tui"
        fi

        _RemoveMpvTmp
        sed -i "/${BASHPID}/d" "$MPM_PIDS"
        kill -SIGTERM "$(pidof -x "$cmd")" >/dev/null 2>&1
        _MenuFooter
    ) &

}
