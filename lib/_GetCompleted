#!/usr/bin/env bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154
_GetCompleted() {

    cd "$main_dir" || exit 1
    _IfPartsExist

    if [[ $downloadTmpList =~ default|list ]]; then
        clear
        printf '\n%s\n' " ${info}Downloads completed, temporary list preserved...${nc}"
        downloadTmpList="downloaded"
        sleep 2
        # unset downloadTmpList
    else
        _BlankLine
        _Prompt -n " ${info}Downloads completed, KEEP playlist?:${nc}" && {
            mv -f "$M3UFILE"_origin "$M3UFILE"
            mv -f "$TITLES"_origin "$TITLES"
            printf '\n%s\n' \
            " ${critical}If it was a temporary list, don't forget to save it.${nc}"
            sleep 2
            _CheckParallelDownloads --after
            _Menu
        }

        printf '%s\n' " ${critical}Removing ${M3UFILE##*/} list...${nc}"
        sleep 2

        rm {"$M3UFILE"{,_origin},"$TITLES"{,_origin}}
        rm -f "$tmp_dir"/list_tmp 2>/dev/null
    fi

    _PolybarIpc
    _CheckParallelDownloads --after
    _Menu

}
