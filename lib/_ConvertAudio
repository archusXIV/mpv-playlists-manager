#!/bin/bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154,SC2164
_ConvertAudio() {

    if [[ -d "$audios_dir"/"${list%.*}" ]]; then
        cd "$audios_dir"/"${list%.*}"
    else
        cd "$audios_dir" || exit 1
    fi

    if [[ -n $default_conversion_format ]]; then
        __
        printf '%s\n' " ${task}Default format set to $default_conversion_format.${nc}"
        __
        printf '%s\n' " ${info}Converting files in ${task}$default_conversion_format${b}...${nb}${nc}"
        _"$default_conversion_format"
    else
        # functions _mp3 _flac _wav & _ogg are in ~/.config/mpm/mpmrc
        __
        printf '%s\n' " ${task}Default format disabled." \
        " Press Enter to abort conversion.${nc}"
        __
        read -rn1 \
        -p "${info}"' Select an output format [1 = mp3] [2 = flac] [3 = wav] [4 = ogg]: '"${nc}" conv
        __
        case "$conv" in
            1)
                echo " ${info}Converting files in ${task}mp3${b}...${nb}${nc}"
                _mp3
            ;;
            2)
                echo " ${info}Converting files in ${task}flac${b}...${nb}${nc}"
                _flac
            ;;
            3)
                echo " ${info}Converting files in ${task}wav${b}...${nb}${nc}"
                _wav
            ;;
            4)
                echo " ${info}Converting files in ${task}ogg${b}...${nb}${nc}"
                _ogg
            ;;
            *)
                echo " ${critical}Wrong option, conversion aborted...${nc}"
                sleep 3
                clear
                _Menu
            ;;
        esac
    fi

    rm ./*.webm
    echo " ${info}Conversion done.${nc}"
    sleep 2

}

