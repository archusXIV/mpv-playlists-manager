#!/bin/bash
## This is a part of main script: mpm.

_LoadPlaylist() {

    prompt=( "[B]ack to main menu," \
             "Load [D]efault," \
             "(down)Load [F]rom collection:" )

    if (( $(_GetLinesList -q) > 0 )); then
        echo ${g} "${prompt[@]}" ${nc}
        __
    else
        unset prompt[1]
        echo ${g} "${prompt[*]}" ${nc}
        __
    fi

    read -rsn 1 choice
    case "$choice" in
        b|B)    _Menu
        ;;
        d|D)    read -rsn 1 -p ${g}' [A]udio only, [V]ideo?:'${nc} load
                clear
                case "$load" in
                    a|A)    _LoadAudio -q ;;
                    v|V)    _GetQualityCodes -q &
                            _CheckCode -q 2>/dev/null
                            _LoadVideo ;;
                esac
        ;;
        f|F)    __
                echo -e " ${g}Select a playlist to load (Press 'q' to quit mpv):\n${nc}"
                PS3=" "
                select list in $(find "$playlists_dir" -name "*.m3u" -o -name "*_origin" \
                    | sort -d | sed 's,.*/,,'); do

                    list="$playlists_dir"/"$list"
                    if ! grep -q -e '^https' "$list"; then
                        echo " ${r}$list is empty...${nc}"
                        sleep 3
                        break
                    fi

                    echo -e " ${g}Getting videos titles...please wait.${nc}\n"
                    _GetMediaTitle -l > "$tmp_dir"/download
                    cat -n "$tmp_dir"/download
                    __
                    echo " ${g}[L]oad from site, [A]udio download or [V]ideo download"
                    echo " (Press '^C' to quit youtube-dl):${nc}"
                    read -rsn 1 letter
                    case "$letter" in
                        a|A)    _DownloadAudio ;;
                        l|L)    _CheckCode -l ;;
                        v|V)    _DownloadVideo ;;
                    esac
                done
        ;;
    esac

}
