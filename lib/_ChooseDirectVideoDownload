#!/bin/bash
## This is a part of main script: mpm.

# shellcheck disable=SC2076,SC2154
_ChooseDirectVideoDownload() {

    _GetSelected
    clear
    cd "$videos_dir"/"${list%.*}" || exit 1

    mapfile -t DIRECT < <(grep '^https' "$CHOOSE1")

    for line in "${DIRECT[@]}"; do

        if [[ $direct_download = yes ]]; then
            printf '%s\n' " ${task}Direct download enabled.${nc}"
        else
            printf '%s\n' " ${task}Download method = direct.${nc}"
        fi
        __
        printf '%s\n' " ${info}$chooseVideoCounter file(s) left to downloads.${nc}" \
        " Downloading: $(_GetLinkTitle -s)${nc}"

        if [[ $line =~ 'youtube.com' && $(_GetLinkTitle -s) =~ '/' ]]; then
            # downloader presets described in ~/.config/mpm/mpmrc
            youtube-dl "${ytdlPreset_FS[@]}" \
            "${ytdlPreset_X[@]}" "$line"
            clear
        elif [[ $line =~ 'youtube.com' ]]; then
            youtube-dl \
            --output "$(_GetLinkTitle -s).%(ext)s" \
            "${ytdlPreset_X[@]}" "$line"
        else
            youtube-dl \
            --output "$(_GetLinkTitle -s).%(ext)s" \
            "${ytdlPreset_NC[@]}" "$line"
            clear
        fi

        sed -i '1d' "$SELECTEDTITLES"
        ((chooseVideoCounter--))

    done

    unset line
    echo " ${info}All done${nc}"
    sleep 2

}
