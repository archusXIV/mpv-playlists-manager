#!/bin/bash
## This is a part of main script: mpm.

_LoadLocal() {
    # for french env too...
    local AUDIOS VIDEOS zic
    AUDIOS=$(find $HOME -maxdepth 2 -type d -name "Music" -o -name "Musique")
    VIDEOS=$(find $HOME -maxdepth 2 -type d -name "Videos" -o -name "Vid√©os")
    zic=$(echo "$AUDIOS" | awk -F"/" '{print $NF}')
    vid=$(echo "$VIDEOS" | awk -F"/" '{print $NF}')
    
    read -rsn 1 -p ${g}' Type of media, [A]udio or [V]ideo ?: '${nc} choice
    case "$choice" in
        a|A)
            __
            echo -e " ${g}Load a directory [D] or file(using ranger) [F] ?: ${nc}\n"
            read -rsn 1 audio
            case "$audio" in
                d|D)
                    PS3=" Select a directory to queue in mpv: "
                    select dir in $(find "$AUDIOS" -maxdepth 1 -type d -not -name \
                        "$zic" | sort | sed 's,.*/,,'); do
                        if [[ $(find "$AUDIOS"/"$dir" -type d -empty) ]]; then
                            echo " ${r}$dir is empty. Wait and try again...${nc}"
                            sleep 3
                            break
                        else
                            # checking for content in linked directories.
                            if [[ -z $(command ls "$AUDIOS"/"$dir") ]]; then
                                echo " ${r}This symlink points to an empty directory!"
                                echo " Wait and try again...${nc}"
                                sleep 3
                                break
                            fi
                            __
                            mpv --no-video "$AUDIOS"/"$dir"/*
                            break
                        fi
                    done
                    _Menu
                ;;
                f|F)
                    ranger "$AUDIOS"; _Menu
                ;;
            esac
        ;;
        v|V)
            __
            echo -e " ${g}What would you like to load, a directory [D] or file(s) [F] ?: ${nc}\n"
            read -rsn 1 video
            case "$video" in
                d|D)
                    PS3=" Select a directory to queue in mpv: "
                    select dir in $(find "$VIDEOS" -maxdepth 1 -not -name \
                        "$vid" | sort | sed 's,.*/,,'); do
                        if [[ $(find "$VIDEOS"/"$dir" -type d -empty) ]]; then
                            echo " ${r}$dir is empty. Wait and try again...${nc}"
                            sleep 3
                            break
                        else
                            if [[ -z $(command ls "$VIDEOS"/"$dir") ]]; then
                                echo " ${r}This symlink points to an empty directory!"
                                echo " Wait and try again...${nc}"
                                sleep 3
                                break
                            fi
                            __
                            mpv "$VIDEOS"/"$dir"/*
                            break
                        fi
                    done
                    _Menu
                ;;
                f|F)
                    ranger "$VIDEOS"; _Menu
                ;;
            esac
        ;;
    esac

}
