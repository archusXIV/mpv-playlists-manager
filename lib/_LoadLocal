#!/bin/bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154
_LoadLocal() {

    local AUDIOS VIDEOS zic vid
    # we use -maxdepth 2 in case our directories are in subdirectories.
    AUDIOS=$(find "$HOME" -maxdepth 2 -type d -wholename "$MUSIC_DIR")
    VIDEOS=$(find "$HOME" -maxdepth 2 -type d -wholename "$VIDEO_DIR")
    zic=$(echo "$AUDIOS" | awk -F"/" '{print $NF}')
    vid=$(echo "$VIDEOS" | awk -F"/" '{print $NF}')

    read -rsn 1 \
    -p "${info}"' Play: [1] Audio dir, [2] Audio files, [3] Video dir or [4] Video files?: '"${nc}" choice
    case "$choice" in
        1)
            _ReplaceSpaces -l
            clear
            __
            echo -e " ${info}Directories in $AUDIOS: ${nc}\n"
            PS3=""$'\n'"${info}Your selection number: ${nc}"
            select dir in $(find -L "$AUDIOS" -maxdepth 1 -type d -not -name \
                "$zic" | sort | sed 's,.*/,,'); do

                if [[ $(find "$AUDIOS"/"$dir" -type d -empty) ]]; then
                    __
                    printf '%s\n' " ${critical}$dir is empty. Wait and try again...${nc}"
                    sleep 4
                    break
                else
                    # checking for content in linked directories.
                    command ls "$AUDIOS"/"$dir" >/dev/null || {
                        __
                        printf '%s\n' " ${critical}This symlink points to an empty directory!" \
                        " Wait and try again...${nc}"
                        sleep 4
                        break
                    }

                    clear
                    mpv --no-video "$AUDIOS"/"$dir"/*
                    break

                fi

            done
        ;;
        2)
            clear; "$FILEMANAGER" "$AUDIOS"; return
        ;;
        3)
           _ReplaceSpaces -l
            clear
            __
            echo -e " ${info}Directories in $VIDEOS: ${nc}\n"
            PS3=""$'\n'"${info}Your selection number: ${nc}"
            select dir in $(find -L "$VIDEOS" -maxdepth 1 -not -name \
                "$vid" | sort | sed 's,.*/,,'); do

                if [[ $(find "$VIDEOS"/"$dir" -type d -empty) ]]; then
                    __
                    printf '%s\n' " ${critical}$dir is empty. Wait and try again...${nc}"
                    sleep 4
                    break
                else

                    command ls "$VIDEOS"/"$dir" >/dev/null || {
                        __
                        printf '%s\n' " ${critical}This symlink points to an empty directory!" \
                        " Wait and try again...${nc}"
                        sleep 4
                        break
                    }

                    clear
                    mpv "$VIDEOS"/"$dir"/*
                    break

                fi

            done
        ;;
        4)
            clear; "$FILEMANAGER" "$VIDEOS"; _Menu
        ;;
        *)
            printf '%s\n' " ${critical}Wrong option $choice!${nc}"
            sleep 3
            return
        ;;
    esac

}
