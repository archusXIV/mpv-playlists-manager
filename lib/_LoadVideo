#!/bin/bash
## This is a part of main script: mpm.

# shellcheck disable=SC2154,SC2015,SC2034
_LoadVideo() {

    local M3UFILE

    case "$1" in
        -c) M3UFILE="$CHOOSE1" ;;
        -l) M3UFILE="$list" ;;
        -q) M3UFILE="$QUEUE" ;;
        -v)
            if [[ -f $VIDEO_URLS ]]; then
                M3UFILE="$VIDEO_URLS"
            else
                echo " ${critical}No links in the list${nc}"
                sleep 2 && return
            fi
        ;;
    esac

    clear
    __
    printf '%s\n' " ${critical}Tip: You may want to put this in your mpv.conf:" \
    " ${info}term-playing-msg='Tiltle: \${media-title}'"
    echo -e " ${critical}Otherwise press I in mpv for more infos.${nc}\n"
    file="${M3UFILE##*/}" file="${file%%.*}"
    printf '%s\n' " ${info}Playing: ${file}${nc}"
    __
    
    # change mpv settings in ~/.config/mpm/mpmrc
    _MpvVideoOptions "$M3UFILE"

    if [[ -f "$VIDEO_URLS" ]]; then
        clear
        __

        declare -a TMP=( "$VIDEO_URLS" "$VIDEO_TITLES" "$FFOP" "$YTOP" "$CHOOSE1" )

        _Prompt " ${info}Temporary video list still exist, KEEP it?:${nc}" || {
            rm -f "${TMP[@]}" 2>/dev/null
            echo " ${critical}Temporary video list removed...${nc}"
            sleep 3
        }
        __
    elif [[ -f $CHOOSE1 ]]; then
        rm -f "$CHOOSE1" "$list"_origin 2>/dev/null
        [[ $quit_after_task = yes ]] && exit || _Menu
    else
        rm -f "${TMP[@]}" 2>/dev/null
        [[ $quit_after_task = yes ]] && exit || _Menu
    fi
    _Menu
}
